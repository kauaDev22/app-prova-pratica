
# Prova PrÃ¡tica - CI/CD com FastAPI, Docker, Kubernetes, Kustomize e ArgoCD

## ğŸ“¦ Projeto

API simples desenvolvida com **FastAPI**, contendo 3 endpoints:

- `/` â†’ retorna `{"message": "Hello World"}`
- `/square/{x}` â†’ retorna o quadrado de `x`
- `/double/{x}` â†’ retorna o dobro de `x`

---

## âš™ï¸ Tecnologias usadas

- FastAPI
- Pytest (âš ï¸ pendente de ajuste)
- Docker
- Docker Hub (`kaua010/prova-pratica`)
- GitHub Actions
- Kustomize
- Kubernetes (com Kind local)
- ArgoCD (deploy automatizado)

---

## ğŸ§ª Testes (em andamento)

Os testes foram preparados com `pytest` e `TestClient` da FastAPI. O objetivo era testar os trÃªs endpoints da API. Os testes ainda precisam de ajustes nos imports devido Ã  estrutura de pastas.

---

## ğŸ³ Docker

### Build da imagem:

```bash
docker build -t kaua010/prova-pratica:latest .
```

### Push para o Docker Hub:

```bash
docker push kaua010/prova-pratica:latest
```

---

## ğŸ” CI/CD com GitHub Actions

### Workflow executa:

- Pytest (em construÃ§Ã£o)
- CriaÃ§Ã£o da imagem Docker
- Push para Docker Hub
- AtualizaÃ§Ã£o do `kustomization.yaml` com nova tag
- Commit e push automÃ¡tico da nova tag

---

## â˜¸ï¸ Kubernetes com Kustomize

Estrutura de diretÃ³rios:

```
k8s/
â”œâ”€â”€ base/
â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”œâ”€â”€ service.yaml
â”‚   â””â”€â”€ kustomization.yaml
â””â”€â”€ overlays/
    â””â”€â”€ dev/
        â”œâ”€â”€ kustomization.yaml
```

Comandos para aplicar:

```bash
kubectl apply -k k8s/overlays/dev
```

---

## ğŸ”§ Cluster com Kind (local)

Criado com 3 nodes (1 control-plane, 2 workers):

```yaml
# kind-config.yaml
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
- role: worker
- role: worker
```

CriaÃ§Ã£o:

```bash
kind create cluster --config kind-config.yaml
```

---

## ğŸš€ ArgoCD

### InstalaÃ§Ã£o

Instalado e configurado localmente para gerenciar o cluster Kind.

### AplicaÃ§Ã£o

Criado um `Application` no ArgoCD apontando para o repositÃ³rio Git e pasta de configuraÃ§Ãµes (`k8s/overlays/dev`).

- App Health: âœ… **Healthy**
- Sync Status: âš ï¸ **Unknown**
- App Conditions: âŒ **1 Error**

> âš ï¸ O erro ainda serÃ¡ investigado. PossÃ­veis causas incluem imagem invÃ¡lida ou recurso com falha de validaÃ§Ã£o.

---

## âœ… Ãšltima etapa realizada

Na interface web do ArgoCD, a aplicaÃ§Ã£o `prova-pratica` foi reconhecida e estÃ¡ **Healthy**, mas com um erro de condiÃ§Ã£o e status de sincronizaÃ§Ã£o **Unknown**.

---

## ğŸ“Œ PrÃ³ximos passos

- Corrigir erro de import nos testes com pytest.
- Validar status de sincronizaÃ§Ã£o no ArgoCD.
- Testar o `port-forward` com `kubectl`:

```bash
kubectl port-forward svc/fastapi-service 8000:80
```

E acessar:

```
http://localhost:8000/
```

---

## ğŸ§‘â€ğŸ’» Autor

- Docker Hub: [kaua010](https://hub.docker.com/u/kaua010)

usei o chatgpt para organizar melhor os passos.